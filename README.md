# Airワーク自動化プログラム

## 📋 概要

このプログラムは、Airワーク求人管理システムにおける以下の作業を自動化します：

1. **ログイン処理** - Airワークへの自動ログイン
2. **データ取得** - 応募者情報のCSVダウンロードと処理
3. **履歴書取得** - 応募者ごとの履歴書PDFダウンロード（または画面キャプチャ）
4. **メール送信** - 各支店への自動メール送信（Outlookテンプレート使用）
5. **完了通知** - 処理完了後の通知メール送信

## 🎯 動作要件

> **【重要】前提となる動作環境**
> 本プログラムは、**Windows OS** 上で **Microsoft Edge** と **Microsoft Outlook（デスクトップ版）** を制御するように設計されています。これらがインストールされていない環境（Mac、Web版Outlookなど）では動作しません。

### 必須環境
- **OS**: Windows 10/11
- **Python**: 3.8以上
- **ブラウザ**: Microsoft Edge
- **メールクライアント**: Microsoft Outlook（Excel連携機能使用）

### 前提条件
- `program/config.yaml` に AirワークのURLとログイン情報が設定されていること
- `~/Downloads/pdf` フォルダが存在すること
- Edgeのダウンロード先が `~/Downloads/pdf` に設定されていること
- `outlookmail_送付フォーマット.xlsx` ファイルが正しく配置されていること

## 📦 インストール手順

### 1. Pythonのインストール
1. [Python公式サイト](https://www.python.org/downloads/)から最新版をダウンロード
2. インストール時に「Add Python to PATH」にチェックを入れる

### 2. 必要なパッケージのインストール
プロジェクトフォルダで以下のコマンドを実行：

```bash
cd program
pip install -r requirements.txt
```

### 3. フォルダの準備
以下のフォルダを作成してください：

```
C:\Users\[ユーザー名]\Downloads\pdf
```

### 4. Edgeブラウザの設定
1. Edge を開く
2. 設定 → ダウンロード
3. ダウンロード先を `C:\Users\[ユーザー名]\Downloads\pdf` に変更
4. 「ダウンロード時に保存先を確認する」をOFFに設定

## 🚀 使い方

### 基本的な実行方法

1. **バッチファイルをダブルクリック**
   ```
   処理開始_escキーで停止可能.bat
   ```

2. **パスワードを入力**
   - プログラム実行用のパスワードを入力してください

3. **自動処理が開始**
   - マウスやキーボードを操作しないでください
   - 画面には処理状況が表示されます

### ⚠️ 重要な注意事項

#### 実行前の確認
- [ ] `program/config.yaml` に正しいURLとログイン情報を入力したか？
- [ ] Edgeのダウンロード設定は正しいか？
- [ ] Outlookは起動しているか？

#### 実行中の注意
- **マウスを画面の四隅に置かないこと** - エラーの原因になります
- **マウス・キーボードを触らないこと** - 処理が中断されます
- **他の作業はしないこと** - PC を自動操作専用にしてください

## ⌨️ 操作方法

### 緊急停止
- **ESCキー** - プログラムを即座に停止します



## 📁 プロジェクト構成

```
airwork-project/
│
├── 処理開始_escキーで停止可能.bat    # 実行用バッチファイル
├── config暗号化ツール.bat           # 設定ファイル暗号化ツール
├── 当プログラムの案内.docx
├── 当自動操作の説明.mp4
├── README.md                        # このファイル
├── CONFIG暗号化の手順.md            # 暗号化の詳細手順
│
└── program/                         # プログラム本体
    ├── new_automation.py            # メインスクリプト
    ├── encrypt_config.py            # 設定ファイル暗号化スクリプト
    ├── config.yaml                  # 設定ファイル（URL/ID/PASSを設定）
    ├── requirements.txt             # 必要なパッケージ一覧
    ├── outlookmail_送付フォーマット.xlsx  # メールテンプレート
    │
    └── logs/                        # 実行ログ（自動生成）
         └── automation_YYYYMMDD_HHMMSS.log
│
└──＊Airwork自動操作_配布用
```

**注意**: `program/config.enc`（暗号化設定ファイル）はリポジトリには含まれません。管理者が必要に応じて作成し、配布用パッケージに含めるものです。

## ⚙️ 設定ファイル（config.yaml）

`config.yaml` に、AirワークのURLやログインID・パスワードを設定します。

```yaml
# ブラウザパス
edge_path: 'C:/Program Files (x86)/Microsoft/Edge/Application/msedge.exe %s'

# ダウンロードフォルダ
download_folder: '~/Downloads/pdf'

# Airワーク設定
url: 'https://ats.rct.airwork.net/interaction'
username: 'your_account'
password: 'your_password'
```

> ✅ 実ユーザー情報を書き込んだ `config.yaml` は、絶対にGitリポジトリへコミットしないでください。

## 📊 処理フロー

1. **初期化**
   - パスワード認証
   - 設定ファイル読み込み（config.yaml または config.enc）
   - ログ初期化

2. **ブラウザ操作**
   - Edge起動
   - Airワークへログイン
   - 応募者データCSVをダウンロード

3. **データ処理**
   - CSVファイルを読み込み
   - 必要な情報を抽出（氏名、年齢、アドレス、支店名、職種）
   - 54歳以下の応募者を対象に処理

4. **応募者ごとの処理**（ループ）
   - 応募者を検索
   - 履歴書PDFをダウンロード（または画面キャプチャ）
   - 支店宛にメール送信（添付ファイル付き）
   - 対応履歴を更新

5. **完了処理**
   - 全処理完了通知メールを送信
   - ログ出力
   - クリーンアップ

## 🔧 トラブルシューティング

### よくあるエラーと対処法

#### 1. パスワードエラー
```
パスワードが違います。再度入力してください。
```
**対処法**: 正しいパスワードを入力してください。

#### 2. 要素の取得エラー
```
Message: element not visible
```
**対処法**:
- ページの読み込みが遅れている可能性があります
- Airワークの画面レイアウトが変更された可能性があります
- ブラウザのズーム倍率を100%に設定して再試行してください

#### 3. CSVファイルが見つからない
```
CSVファイルが見つかりません
```
**対処法**:
- `Downloads/pdf`フォルダが存在するか確認
- フォルダ内に古いCSVファイルがあれば削除
- Edgeのダウンロード設定を確認

#### 4. Excel/Outlookエラー
```
Excelファイルの内容表示待機がタイムアウトしました
```
**対処法**:
- Outlookが起動しているか確認
- `outlookmail_送付フォーマット.xlsx`が正しい場所にあるか確認
- Excelマクロのセキュリティ設定を確認

#### 5. マウスエラー
```
マウスを画面の四隅に置いている状態で実行するとエラーになります
```
**対処法**:
- マウスを画面中央に移動してから実行
- プログラムが自動的にマウスを中央に移動します

### ログファイルの確認

エラーが発生した場合は、以下のログファイルを確認してください：

```
program/logs/automation_YYYYMMDD_HHMMSS.log
```

ログには以下の情報が記録されます：
- 処理開始・終了時刻
- 各ステップの実行状況
- エラーメッセージとスタックトレース
- 処理の成功/失敗

## 🔐 セキュリティ

### パスワード保護
- プログラムは実行時にパスワード認証を要求します
- パスワードは暗号化されて保存されています（Fernet暗号化）
- 不正な実行を防止します

### config.yaml の取り扱い

- `config.yaml` にはログインIDやパスワードが平文で保存されます。
- **重要**: 第三者にファイルを見られないよう管理してください。
- Gitリポジトリで管理する場合は、必ずこれらの値を削除したテンプレート状態でコミットしてください。

### config.enc の利用（配布時）

管理者が他のユーザーに当ツールを配布する場合、`config.yaml` を暗号化した `config.enc` を作成して配布することを推奨します。

#### 暗号化手順（管理者向け）

1. `config.yaml` に正しいID/PASSを入力
2. `config暗号化ツール.bat` を実行し、暗号化パスワードを設定
3. 生成された `program/config.enc` を配布用フォルダへ移動
4. `config.yaml` はID/PASSを消去して元に戻す

#### 利用手順（利用者向け）

1. `program/config.enc` がある状態でプログラムを実行
2. 設定ファイルの復号パスワードを入力
3. 自動的に復号されて処理が開始

**利点**:
- ✅ ユーザーに見せずにID/PASSを埋め込める
- ✅ 設定ファイルの改ざんを防げる

### 注意事項
- `config.yaml` または `config.enc` を適切に管理してください
- プログラムの共有時は機密情報の取り扱いに注意してください
- ログファイルには個人情報が含まれる可能性があるため、定期的に削除してください
- 暗号化パスワードは安全な方法で伝達してください（公開チャンネルでの共有は避ける）

## 📝 メンテナンス

### 定期的に実施すること

#### ログファイルの整理
`program/logs/` フォルダ内のログファイルは自動的に蓄積されます。
定期的（月1回程度）に古いログファイルを削除してください。

#### ダウンロードフォルダの整理
`~/Downloads/pdf` フォルダには処理済みのPDFやスクリーンショットが保存されます。
必要に応じて整理・バックアップしてください。

#### 設定の更新
- ブラウザパスや待機時間、フォルダ構成を変更したい場合は `program/config.yaml` を更新してください。
- AirワークのURLやログイン情報を変更したい場合は `program/secrets.yaml` を更新し、共有前にテンプレへ戻すことを忘れないでください。

## 🆘 サポート

### 質問・問題報告

プログラムに関する質問や問題が発生した場合は、以下の情報を添えて報告してください：

1. **エラーメッセージ** - 表示されたエラーの内容
2. **ログファイル** - `program/logs/` 内の最新ログ
3. **スクリーンショット** - エラー発生時の画面
4. **実行環境** - Windows バージョン、Python バージョン
5. **再現手順** - エラーが発生するまでの操作

## 📜 変更履歴

### Version 1.0.0（現行版）
- 初回リリース
- Airワーク自動操作機能実装
- パスワード認証機能
- ESCキー停止機能
- 処理完了通知機能

## 🎓 補足資料

- **詳細な説明**: `当プログラムの説明と事前準備の案内.docx`
- **操作デモ動画**: `当自動操作の説明.mp4`

## ⚖️ ライセンスと免責事項

このプログラムは社内業務効率化のために作成されました。

**免責事項**:
- 本プログラムの使用は自己責任でお願いします
- プログラム実行中のシステムエラーやデータ損失について、製作者は責任を負いません
- 重要なデータは事前にバックアップを取ることを推奨します

---

**最終更新日**: 2025年12月18日

