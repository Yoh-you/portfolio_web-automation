# Airワーク自動化プログラム

## 📋 概要

このプログラムは、Airワーク求人管理システムにおける以下の作業を自動化します：

1. **ログイン処理** - Airワークへの自動ログイン
2. **データ取得** - 応募者情報のCSVダウンロードと処理
3. **履歴書取得** - 応募者ごとの履歴書PDFダウンロード（または画面キャプチャ）
4. **メール送信** - 各支店への自動メール送信（Outlookテンプレート使用）
5. **完了通知** - 処理完了後の通知メール送信

## 🎯 動作要件

> **【重要】前提となる動作環境**
> 本プログラムは、**Windows OS** 上で **Microsoft Edge** と **Microsoft Outlook（デスクトップ版）** を制御するように設計されています。これらがインストールされていない環境（Mac、Web版Outlookなど）では動作しません。

### 必須環境
- **OS**: Windows 10/11
- **Python**: 3.8以上
- **ブラウザ**: Microsoft Edge
- **メールクライアント**: Microsoft Outlook（Excel連携機能使用）

### 前提条件
- `program/secrets.yaml` に AirワークのURLとログイン情報が設定されていること
- `~/Downloads/pdf` フォルダが存在すること
- Edgeのダウンロード先が `~/Downloads/pdf` に設定されていること
- `outlookmail_送付フォーマット.xlsx` ファイルが正しく配置されていること

## 📦 インストール手順

### 1. Pythonのインストール
1. [Python公式サイト](https://www.python.org/downloads/)から最新版をダウンロード
2. インストール時に「Add Python to PATH」にチェックを入れる

### 2. 必要なパッケージのインストール
プロジェクトフォルダで以下のコマンドを実行：

```bash
cd program
pip install -r requirements.txt
```

### 3. フォルダの準備
以下のフォルダを作成してください：

```
C:\Users\[ユーザー名]\Downloads\pdf
```

### 4. Edgeブラウザの設定
1. Edge を開く
2. 設定 → ダウンロード
3. ダウンロード先を `C:\Users\[ユーザー名]\Downloads\pdf` に変更
4. 「ダウンロード時に保存先を確認する」をOFFに設定

## 🚀 使い方

### 基本的な実行方法

1. **バッチファイルをダブルクリック**
   ```
   処理開始_escキーで停止可能.bat
   ```

2. **パスワードを入力**
   - プログラム実行用のパスワードを入力してください

3. **確認画面で内容を確認**
   - 処理対象のデータが表示されます（10秒後に自動続行）
   - 問題なければ「Y」を入力、または待機

4. **自動処理が開始**
   - マウスやキーボードを操作しないでください
   - 画面には処理状況が表示されます

### ⚠️ 重要な注意事項

#### 実行前の確認
- [ ] `program/secrets.yaml` に正しいURLとログイン情報を入力したか？
- [ ] `Downloads/pdf` フォルダは空になっているか？
- [ ] Edgeのダウンロード設定は正しいか？
- [ ] Outlookは起動しているか？
- [ ] 他のウィンドウは閉じているか？

#### 実行中の注意
- **マウスを画面の四隅に置かないこと** - エラーの原因になります
- **マウス・キーボードを触らないこと** - 処理が中断されます
- **他の作業はしないこと** - PC を自動操作専用にしてください

## ⌨️ 操作方法

### 緊急停止
- **ESCキー** - プログラムを即座に停止します



## 📁 プロジェクト構成

```
airwork-project/
│
├── 処理開始_escキーで停止可能.bat    # 実行用バッチファイル
├── config暗号化ツール.bat           # 設定ファイル暗号化ツール
├── 当プログラムの説明と事前準備の案内.docx
├── 当自動操作の説明.mp4
├── README.md                        # このファイル
├── CONFIG暗号化の手順.md            # 暗号化の詳細手順
│
└── program/                         # プログラム本体
    ├── new_automation.py            # メインスクリプト
    ├── encrypt_config.py            # 設定ファイル暗号化スクリプト
    ├── config.yaml                  # 一般設定（非機密）
    ├── secrets.yaml                 # AirワークURL・ログイン情報（テンプレ）
    ├── config.enc                   # 設定ファイル（暗号化版）
    ├── requirements.txt             # 必要なパッケージ一覧
    ├── outlookmail_送付フォーマット.xlsx  # メールテンプレート
    │

    │
    └── logs/                        # 実行ログ（自動生成）
        └── automation_YYYYMMDD_HHMMSS.log
```

**注意**: メンバーに共有する際は、`config.yaml` の代わりに `config.enc`（暗号化版）を共有してください。`secrets.yaml` はテンプレ状態でリポジトリに含まれていますが、実際のID/パスワードを書き込んだら共有前に必ず空のテンプレに戻してください。

## ⚙️ 設定ファイル（config.yaml / secrets.yaml）

`config.yaml` にはブラウザ/フォルダ/画像設定などの非機密情報だけを記載し、AirワークのURL・ログイン情報などの機密値は `secrets.yaml` に分離しました。`config.yaml` からは `secrets_file` で参照します。

```yaml
# ブラウザパス
edge_path: 'C:/Program Files (x86)/Microsoft/Edge/Application/msedge.exe %s'

# ダウンロードフォルダ
download_folder: '~/Downloads/pdf'

# 機密情報ファイル
secrets_file: 'secrets.yaml'
```

`program/secrets.yaml` はリポジトリにテンプレとして含まれているため、実際に運用するPCでは必ず以下のように書き換えてください（値は例です）。

```yaml
# ここに表示させたいページのURLを設定
url: 'https://ats.rct.airwork.net/interaction'

# ここにログイン情報を設定
login_info:
  username: "your_account"
  password: "your_password"
```

> ✅ 実ユーザー情報を書き込んだ `secrets.yaml` は共有前にテンプレ状態へ戻すか、Gitでコミットしないよう注意してください。

## 📊 処理フロー

1. **初期化**
   - パスワード認証
   - 設定ファイル読み込み
   - ログ初期化

2. **ブラウザ操作**
   - Edge起動
   - Airワークへログイン
   - 応募者データCSVをダウンロード

3. **データ処理**
   - CSVファイルを読み込み
   - 必要な情報を抽出（氏名、年齢、アドレス、支店名、職種）
   - 54歳以下の応募者を対象に処理

4. **応募者ごとの処理**（ループ）
   - 応募者を検索
   - 履歴書PDFをダウンロード（または画面キャプチャ）
   - 支店宛にメール送信（添付ファイル付き）
   - 対応履歴を更新

5. **完了処理**
   - 全処理完了通知メールを送信
   - ログ出力
   - クリーンアップ

## 🔧 トラブルシューティング

### よくあるエラーと対処法

#### 1. パスワードエラー
```
パスワードが違います。再度入力してください。
```
**対処法**: 正しいパスワードを入力してください。

#### 2. 要素の取得エラー
```
Message: element not visible
```
**対処法**:
- ページの読み込みが遅れている可能性があります
- Airワークの画面レイアウトが変更された可能性があります
- ブラウザのズーム倍率を100%に設定して再試行してください

#### 3. CSVファイルが見つからない
```
CSVファイルが見つかりません
```
**対処法**:
- `Downloads/pdf`フォルダが存在するか確認
- フォルダ内に古いCSVファイルがあれば削除
- Edgeのダウンロード設定を確認

#### 4. Excel/Outlookエラー
```
Excelファイルの内容表示待機がタイムアウトしました
```
**対処法**:
- Outlookが起動しているか確認
- `outlookmail_送付フォーマット.xlsx`が正しい場所にあるか確認
- Excelマクロのセキュリティ設定を確認

#### 5. マウスエラー
```
マウスを画面の四隅に置いている状態で実行するとエラーになります
```
**対処法**:
- マウスを画面中央に移動してから実行
- プログラムが自動的にマウスを中央に移動します

### ログファイルの確認

エラーが発生した場合は、以下のログファイルを確認してください：

```
program/logs/automation_YYYYMMDD_HHMMSS.log
```

ログには以下の情報が記録されます：
- 処理開始・終了時刻
- 各ステップの実行状況
- エラーメッセージとスタックトレース
- 処理の成功/失敗

## 🔐 セキュリティ

### パスワード保護
- プログラムは実行時にパスワード認証を要求します
- パスワードは暗号化されて保存されています（Fernet暗号化）
- 不正な実行を防止します

### secrets.yaml の取り扱い

- 実際のURLやログインID/パスワードを書き込むのは `program/secrets.yaml` のみです。
- リポジトリにコミットする前に必ずテンプレート（`URLを入力` などの状態）へ戻してください。
- 運用端末では `git update-index --skip-worktree program/secrets.yaml` でローカル専用ファイルにしておくと安全です。

### config.yaml の暗号化（推奨）

`config.yaml` 自体には機密情報を含めない形になりましたが、配布時は従来通り暗号化済みの `config.enc` を共有する運用を推奨します。暗号化しておくことで環境設定値の改ざんを防げます。

#### 管理者向け：暗号化手順

1. `config暗号化ツール.bat` を実行
2. メニューから「1」を選択
3. パスワードを設定（8文字以上）
4. 生成された `program/config.enc` をメンバーに共有
5. パスワードは別途、安全な方法で伝達

詳細は [`CONFIG暗号化の手順.md`](CONFIG暗号化の手順.md) を参照してください。

#### メンバー向け：暗号化ファイルの使用

1. `program/config.enc` を受け取る
2. 通常通りプログラムを実行
3. 設定ファイルの復号パスワードを入力
4. 自動的に復号されて処理が開始

**利点**:
- ✅ `config.yaml` の改ざんを防げる
- ✅ パスワードを知らない限り復号できない
- ✅ チーム共有時のセキュリティ向上（`secrets.yaml` と併用）

### 注意事項
- `config.yaml` または `config.enc` を適切に管理してください
- プログラムの共有時は機密情報の取り扱いに注意してください
- ログファイルには個人情報が含まれる可能性があるため、定期的に削除してください
- 暗号化パスワードは安全な方法で伝達してください（公開チャンネルでの共有は避ける）

## 📝 メンテナンス

### 定期的に実施すること

#### ログファイルの整理
`program/logs/` フォルダ内のログファイルは自動的に蓄積されます。
定期的（月1回程度）に古いログファイルを削除してください。

#### ダウンロードフォルダの整理
`~/Downloads/pdf` フォルダには処理済みのPDFやスクリーンショットが保存されます。
必要に応じて整理・バックアップしてください。

#### 設定の更新
- ブラウザパスや待機時間、フォルダ構成を変更したい場合は `program/config.yaml` を更新してください。
- AirワークのURLやログイン情報を変更したい場合は `program/secrets.yaml` を更新し、共有前にテンプレへ戻すことを忘れないでください。

## 🆘 サポート

### 質問・問題報告

プログラムに関する質問や問題が発生した場合は、以下の情報を添えて報告してください：

1. **エラーメッセージ** - 表示されたエラーの内容
2. **ログファイル** - `program/logs/` 内の最新ログ
3. **スクリーンショット** - エラー発生時の画面
4. **実行環境** - Windows バージョン、Python バージョン
5. **再現手順** - エラーが発生するまでの操作

## 📜 変更履歴

### Version 1.0.0（現行版）
- 初回リリース
- Airワーク自動操作機能実装
- パスワード認証機能
- ESCキー停止機能
- 処理完了通知機能

## 🎓 補足資料

- **詳細な説明**: `当プログラムの説明と事前準備の案内.docx`
- **操作デモ動画**: `当自動操作の説明.mp4`

## ⚖️ ライセンスと免責事項

このプログラムは社内業務効率化のために作成されました。

**免責事項**:
- 本プログラムの使用は自己責任でお願いします
- プログラム実行中のシステムエラーやデータ損失について、製作者は責任を負いません
- 重要なデータは事前にバックアップを取ることを推奨します

---

**最終更新日**: 2025年12月18日

