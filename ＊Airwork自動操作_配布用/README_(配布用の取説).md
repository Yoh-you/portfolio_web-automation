# Airワーク自動化プログラム - セットアップガイド

## 📋 このパッケージについて

> **【重要】前提となる動作環境**
> 本プログラムは、**Windows OS** 上で **Microsoft Edge** と **Microsoft Outlook（デスクトップ版）** を制御するように設計されています。これらがインストールされていない環境（Mac、Web版Outlookなど）では動作しません。

このパッケージは、Airワーク求人管理システムの業務を自動化するプログラムです。
他のPCでも簡単に実行できるよう、Python環境の自動セットアップ機能を含んでいます。

### 🎯 改良のポイント（Version 1.1）


## 📦 パッケージ内容

### **フォルダ構成**

```
distribution/
│
├── README_(配布用の取説).md                          # このマニュアル
├── START_escキーで処理停止可能.bat                   # ★これを実行してプログラムを開始
│
├── ＊初回のみ_環境構築プログラム起動/                # ★初回セットアップ専用フォルダ
│   ├── 右クリック→「PowerShellで実行」で起動.ps1     # Python環境自動構築スクリプト
│   ├── requirements.txt                              # 必要パッケージ一覧
│   ├── python-3.12.10-amd64.exe                      # Pythonインストーラー
│   └── 環境構築ガイド.md
│
└── program/                                          # プログラム本体
    ├── new_automation.py                             # メインプログラム
    ├── config.enc                                    # 暗号化された設定ファイル（編集不要）
    ├── outlookmail_送付フォーマット.xlsx
    └── logs/                                         # ログ出力用
        └── ...
```

## 🚀 初回セットアップ手順

### ステップ1: ファイルの配置

1. このフォルダ全体を任意の場所に配置してください
   - 推奨: `C:\Users\[ユーザー名]\Desktop\airwork-automation\`
   - **重要**: フォルダパスに日本語や特殊文字が含まれないようにしてください

### ステップ2: Python環境のセットアップ

1. `＊初回のみ_環境構築プログラム起動` フォルダを開きます。
2. **`右クリック→「PowerShellで実行」で起動.ps1`** を右クリック
3. **「PowerShellで実行」** を選択

   > ⚠️ もし「PowerShellで実行」が表示されない場合:
   > - ファイルを右クリック → 「プログラムから開く」 → 「Windows PowerShell」

4. セキュリティ警告が表示された場合は **「実行」** をクリック

5. 以下のメッセージが表示されます：
   ```
   Pythonをインストールしてもよろしいですか？ (y/n)
   ```
   **`y`** を入力して **Enter** を押してください

6. セットアップが自動的に進行します（数分かかります）
   - Python 3.12.10 のインストール
   - 仮想環境の作成
   - 必要なパッケージのインストール

7. 完了メッセージが表示されたら **Enter** を押して終了

### ステップ3: 事前準備

プログラムを実行する前に、以下の準備を行ってください：

#### 3-1. ダウンロードフォルダの作成

```
C:\Users\[ユーザー名]\Downloads\pdf
```

このフォルダを作成してください。

#### 3-2. Microsoft Edge の設定

1. Edge ブラウザを開く
2. 設定（右上の「…」） → 「ダウンロード」
3. 以下を設定：
   - **ダウンロード先**: `C:\Users\[ユーザー名]\Downloads\pdf`
   - **ダウンロード時に保存先を確認する**: **OFF**

#### 3-3. Microsoft Outlook の起動

- プログラム実行前に Outlook を起動しておいてください

### ステップ4: 設定ファイルについて

本パッケージには、あらかじめ設定済みの暗号化ファイル `program/config.enc` が含まれています。
AirワークのURLやログイン情報は設定済みですので、**ユーザー側でのファイル編集は不要**です。
実行時に管理者が発行した「復号パスワード」を入力することで、自動的に読み込まれます。

## ▶️ プログラムの実行方法

### 通常の実行（推奨）

1. `処理開始_escキーで停止可能.bat` をダブルクリック
2. パスワードを入力（管理者から受け取ったパスワード）
3. **（暗号設定ファイル config.enc がある場合のみ）** 設定ファイルの復号パスワードを入力
4. 確認画面で内容を確認し、**`Y`** を入力（または10秒待機）
5. 自動処理が開始されます

### 手動実行（上級者向け）

PowerShell または コマンドプロンプトで：

```powershell
C:\Users\[ユーザー名]\airwork_automation_env\Scripts\python.exe program\new_automation.py [パスワード]
```

## ⚠️ 実行時の重要な注意事項

### 実行前の確認チェックリスト

- [ ] `program\config.yaml`（または`config.enc`）の設定は正しいか？
- [ ] Edge のダウンロード設定は正しいか？
- [ ] Outlook は起動しているか？
- [ ] マウスは画面中央付近にあるか？

### 実行中の注意

- ❌ **マウスやキーボードを触らないでください**
- ❌ **他の作業をしないでください**
- ❌ **マウスを画面の四隅に置かないでください**
- ✅ PCを自動操作専用にしてください

### 緊急停止方法

- **ESC キー** を押すとプログラムが即座に停止します



## 🔐 セキュリティについて

### パスワード管理

このプログラムは2種類のパスワードで保護されています：

1. **プログラム実行パスワード** - プログラムの起動時に必要
2. **設定ファイル復号パスワード** - `config.enc` 使用時に必要（config.yaml使用時は不要）

**重要**: パスワードは管理者から安全な方法で受け取り、厳重に管理してください。

### 設定ファイルについて

- `config.yaml` にはAirワークのURLやログイン情報を記載します。
- `config.enc` は、`config.yaml` を暗号化したファイルです。**配布版ではこちらが使用されることがあります。**
- いずれのファイルも第三者に漏えいしないよう厳重に管理してください。

## 🔧 トラブルシューティング

### セットアップ時のエラー

#### 「Pythonインストーラーが見つかりません」

**原因**: `python-3.12.10-amd64.exe` が同じフォルダにない

**対処法**:
1. インストーラーファイルを管理者から受け取る
2. `setup_python_env.ps1` と同じフォルダに配置
3. 再度セットアップを実行

#### 「PowerShellで実行できません」

**原因**: PowerShell の実行ポリシーが制限されている

**対処法**:
1. PowerShell を管理者として起動
2. 以下のコマンドを実行：
   ```powershell
   Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
   ```
3. 再度セットアップを実行

### プログラム実行時のエラー

#### 「パスワードが違います」

**対処法**: 管理者から受け取った正しいパスワードを入力してください

#### 「画面要素が見つかりませんでした」

**原因**: ページの読み込み遅延やレイアウト変更

**対処法**:
1. ネットワーク環境を確認
2. ブラウザのズーム倍率を **100%** に設定
3. エラーが続く場合はログを確認して管理者に連絡

#### 「CSVファイルが見つかりません」

**対処法**:
1. `Downloads\pdf` フォルダが存在するか確認
2. フォルダ内の古いファイルを削除
3. Edge のダウンロード設定を再確認

#### 「Excelファイルの内容表示待機がタイムアウト」

**対処法**:
1. Outlook が起動しているか確認
2. `outlookmail_送付フォーマット.xlsx` が正しい場所にあるか確認
3. Excel のマクロセキュリティ設定を確認

### ログファイルの確認

エラーが発生した場合は、以下のログファイルを確認してください：

```
program\logs\automation_YYYYMMDD_HHMMSS.log
```

このログファイルを管理者に送付すると、問題の解決が早くなります。

## 📝 定期メンテナンス

### ログファイルの整理

`program\logs\` フォルダ内のログファイルは自動的に蓄積されます。
月1回程度、古いログファイルを削除してください。

### ダウンロードフォルダの整理

`Downloads\pdf` フォルダには処理済みのPDF、およびスクショ画像ファイルが保存されます。
必要に応じて整理・バックアップしてください。

## 🆘 サポート

### 質問・問題報告

プログラムに関する質問や問題が発生した場合は、以下の情報を添えて管理者に連絡してください：

1. **エラーメッセージ** - 表示されたエラーの内容
2. **ログファイル** - `program\logs\` 内の最新ログ
3. **スクリーンショット** - エラー発生時の画面
4. **実行環境**:
   - Windows バージョン
   - 実行した日時
   - 実行した操作手順


## 📚 補足情報

### インストール場所

- **Python**: `C:\Users\[ユーザー名]\AppData\Local\Programs\Python\Python312\`
- **仮想環境**: `C:\Users\[ユーザー名]\airwork_automation_env\`

### 仮想環境について

このプログラムは「仮想環境（venv）」を使用しています。

**利点**:
- システム環境変数を設定する必要がない
- 他のPythonプログラムと干渉しない
- プロジェクトごとに独立した環境を保持

### 必要なパッケージ

```
pyautogui>=0.9.54
Pillow>=10.0.0
pandas>=2.0.0
PyYAML>=6.0
retry>=0.9.2
keyboard>=0.13.5
cryptography>=41.0.0

openpyxl>=3.1.0
pywin32==308
selenium>=4.15.0
webdriver-manager>=4.0.2
```

### アンインストール方法

プログラムが不要になった場合：

1. 以下のフォルダを削除：
   - `C:\Users\[ユーザー名]\airwork_automation_env\`
   - プログラムフォルダ全体

2. Python本体も削除する場合：
   - 「設定」→「アプリ」→「Python 3.12.10」→「アンインストール」

## ⚖️ 免責事項

- 本プログラムの使用は自己責任でお願いします
- 重要なデータは事前にバックアップを取ることを推奨します

---

**最終更新日**: 2025年12月18日