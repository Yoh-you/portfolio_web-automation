# config.yaml 暗号化の手順

## 📌 概要

`config.yaml`にはAirワークのログイン情報（IDとパスワード）が含まれています。
このファイルを暗号化することで、メンバーに共有する際のセキュリティを向上させます。

## 🔐 暗号化の仕組み

- **暗号化方式**: AES-256 + PBKDF2（業界標準の暗号化）
- **パスワード保護**: 復号にはパスワードが必要
- **安全性**: パスワードを知らない限り、内容を見ることはできません

## 📋 管理者用：暗号化の手順

### 1. 暗号化ツールの実行

プロジェクトフォルダで `config暗号化ツール.bat` をダブルクリックします。

```
airwork-project/
├── config暗号化ツール.bat  ← これを実行
└── program/
    ├── config.yaml
    └── encrypt_config.py
```

### 2. メニューから「1」を選択

```
[1] config.yaml を暗号化する
[2] config.enc を復号する（確認用）
[3] 終了

選択してください (1-3): 1
```

### 3. パスワードを2回入力

```
暗号化パスワードを入力してください: ********
確認のため再度入力してください: ********
```

**パスワードの条件**:
- 8文字以上
- 覚えやすく、推測されにくいもの
- メンバーには別途、安全な方法で伝達（Slack DM、口頭など）

### 4. 暗号化完了

成功すると、`program/config.enc` ファイルが生成されます。

```
✓ 暗号化完了: config.yaml → config.enc
```

### 5. ファイル管理

#### メンバーに共有するファイル
- ✅ `program/config.enc` （暗号化ファイル）
- ✅ パスワード（別途、安全な方法で伝達）

#### 共有しないファイル
- ❌ `program/config.yaml` （元のファイル、管理者が保管）

#### 元ファイルの保管
`config.yaml` は削除せず、以下の用途で保管してください：
- 設定変更が必要になった時
- パスワードを忘れた時の復旧
- 新しいパスワードで再暗号化する時

## 👥 メンバー用：暗号化ファイルの使用方法

### 前提条件

メンバーは以下のファイルを受け取ります：
1. `program/config.enc` （暗号化された設定ファイル）
2. 復号パスワード（管理者から別途伝達）

### 使用方法

#### ステップ1: プロジェクトファイルを配置

```
airwork-project/
├── 処理開始_escキーで停止可能.bat
└── program/
    ├── new_automation.py
    ├── config.enc  ← 暗号化ファイルをここに配置
    ├── requirements.txt
    └── images/
```

**重要**: `config.yaml` は不要です。`config.enc` だけあればOKです。

#### ステップ2: プログラムを実行

通常通り `処理開始_escキーで停止可能.bat` を実行します。

```
処理開始_escキーで停止可能.bat をダブルクリック
```

#### ステップ3: パスワードを入力

プログラム実行パスワードを入力後、設定ファイルの復号パスワードを求められます：

```
==================================================
設定ファイル復号
==================================================
config.enc の復号パスワードを入力してください: ********
```

管理者から受け取ったパスワードを入力してください。

#### ステップ4: 自動処理が開始

パスワードが正しければ、自動的に復号されて処理が開始されます。

## ❓ トラブルシューティング

### Q1: パスワードを間違えた場合

```
✗ 設定ファイルの復号に失敗: パスワードが間違っているか、ファイルが破損しています
```

**対処法**: 
- 管理者に正しいパスワードを確認してください
- パスワードは大文字・小文字を区別します

### Q2: config.enc が見つからない

```
config.yaml も config.enc も見つかりません
```

**対処法**:
- `program/config.enc` ファイルが存在するか確認
- ファイルが正しい場所に配置されているか確認

### Q3: 暗号化ファイルが破損している

```
設定ファイルの復号に失敗: ファイルが破損しています
```

**対処法**:
- 管理者から `config.enc` を再度受け取ってください
- ファイル転送時に破損した可能性があります

### Q4: 毎回パスワード入力するのが面倒

**対処法1**: 環境変数を設定（上級者向け）

Windowsの環境変数に以下を追加：
```
変数名: CONFIG_PASSWORD
値: あなたのパスワード
```

⚠️ **セキュリティリスク**: 環境変数に保存すると、PCにアクセスできる人は誰でも復号できます。

**対処法2**: パスワード管理ツールを使用

- 1Password、LastPassなどのパスワード管理ツールに保存
- 実行時にコピー&ペーストで入力

## 🔄 設定変更の手順（管理者用）

設定を変更したい場合（ログイン情報の更新など）：

### 方法1: 元ファイルから再暗号化（推奨）

1. 保管していた `config.yaml` を編集
2. `config暗号化ツール.bat` で再度暗号化
3. 新しい `config.enc` をメンバーに共有

### 方法2: 暗号化ファイルを復号してから編集

1. `config暗号化ツール.bat` で「2」を選択（復号）
2. 復号された `config.yaml` を編集
3. 再度「1」を選択（暗号化）
4. 新しい `config.enc` をメンバーに共有

## 🔒 セキュリティのベストプラクティス

### ✅ やるべきこと

1. **パスワードは安全に伝達**
   - Slack DM、メール、口頭など
   - チャットに履歴が残る場合は後で削除

2. **元ファイルは安全に保管**
   - `config.yaml` は管理者のみが保管
   - USBメモリや暗号化フォルダに保存

3. **定期的にパスワード変更**
   - メンバーが入れ替わった時
   - 3〜6ヶ月ごと

4. **不要なファイルは削除**
   - 復号した `config.yaml` を放置しない
   - 作業完了後は削除する

### ❌ やってはいけないこと

1. **パスワードをファイル名に含める**
   - ❌ `config_パスワードは123456.enc`

2. **平文ファイルをGit/クラウドにアップ**
   - ❌ `config.yaml` をGitHubにプッシュ
   - ❌ `config.yaml` をGoogle Driveに保存

3. **パスワードを公開チャンネルで共有**
   - ❌ Slackの公開チャンネル
   - ❌ メーリングリスト

4. **同じパスワードを使い回す**
   - ❌ プログラム実行パスワードと同じにする
   - ❌ 個人のログインパスワードと同じにする

## 📊 暗号化前後の比較

### 暗号化前（config.yaml）

```yaml
login_info:
  username: "honsha@shain001"  # 平文で見える
  password: "Luft@001"          # 平文で見える
```

誰でも内容を見ることができます ❌

### 暗号化後（config.enc）

```
gAAAAABhIv3Xz... [暗号化されたバイナリデータ]
```

パスワードを知らない限り、内容を見ることはできません ✅

## 📞 サポート

わからないことがあれば、管理者に問い合わせてください。

---

**最終更新日**: 2025年11月2日

